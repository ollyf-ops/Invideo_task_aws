name: 'Ansible deploy'
on:
  push:
    branches:
      - dev

jobs:
  anisble-deploy:
    name: 'Ansible Deploy'
    runs-on: self-hosted
    defaults:
      run:
        working-directory: /sunny
    steps:
      - name: 'Checkout'
        uses: actions/checkout@main
      - name: 'Check ansible connectivity'
        run: ansible test_web -m ping
      - name: 'Run Terraform'
        run: |
          sudo -i
          cd /sunny/Invideo_task_aws/
          echo "To setup provisioner"
          terraform init
          echo "To launch the EC2 cluster: "
          terraform plan -out=aws.tfplan
          terraform apply aws.tfplan --auto-approve
